// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: model_variants.sql

package sqlc

import (
	"context"
	"database/sql"

	"github.com/google/uuid"
	"github.com/lib/pq"
)

const bulkCreateModelVariants = `-- name: BulkCreateModelVariants :exec
WITH data AS (
    SELECT
        unnest($1::text[])          AS part_no,
        unnest($2::text[])              AS gen,
        unnest($3::float8[])        AS engine_cc,
        unnest($4::text[])     AS transmission_type_raw,
        unnest($5::text[])  AS additional_info,
        unnest($6::text[])      AS image_1_link,
        unnest($7::text[])      AS image_2_link,
        unnest($8::text[])      AS image_3_link,
        unnest($9::text[])      AS image_4_link,
        unnest($10::text[])         AS hsn_code,
        unnest($11::text[])      AS description,
        unnest($12::text[])           AS oem_ids_raw,
        unnest($13::text[])             AS make,
        unnest($14::text[])      AS unicode_raw,
        unnest($15::text[])        AS vendor_id_raw,
        unnest($16::text[])    AS platform_codes_raw,
        unnest($17::text[])        AS fuel_types_raw,
        unnest($18::text[])        AS placement,
        unnest($19::text[])             AS type_val,
        unnest($20::int[])        AS year_start,
        unnest($21::int[])          AS year_end
)
INSERT INTO model_variants (
    id,
    part_no,
    gen,
    engine_cc,
    transmission_type,
    additional_info,
    image_1_link,
    image_2_link,
    image_3_link,
    image_4_link,
    hsn_code,
    description,
    oem_ids,
    make,
    unicode,
    vendor_id,
    platform_codes,
    fuel_types,
    placement,
    type,
    year_start,
    year_end
)
SELECT
    gen_random_uuid(),
    d.part_no,
    d.gen,
    d.engine_cc,

    -- transmission_type text[] from CSV string (e.g. "MT,AT")
    COALESCE(
        string_to_array(NULLIF(d.transmission_type_raw, ''), ','),
        ARRAY[]::text[]
    ) AS transmission_type,

    d.additional_info,
    d.image_1_link,
    d.image_2_link,
    d.image_3_link,
    d.image_4_link,
    d.hsn_code,
    d.description,

    -- oem_ids text[]
    COALESCE(
        string_to_array(NULLIF(d.oem_ids_raw, ''), ','),
        ARRAY[]::text[]
    ) AS oem_ids,

    d.make,

    -- unicode text[]
    COALESCE(
        string_to_array(NULLIF(d.unicode_raw, ''), ','),
        ARRAY[]::text[]
    ) AS unicode,

    -- vendor_id text[]
    COALESCE(
        string_to_array(NULLIF(d.vendor_id_raw, ''), ','),
        ARRAY[]::text[]
    ) AS vendor_id,


    -- platform_codes text[]
    COALESCE(
        string_to_array(NULLIF(d.platform_codes_raw, ''), ','),
        ARRAY[]::text[]
    ) AS platform_codes,

    -- fuel_types text[] ("PETROL", "DIESEL", "PETROL,DIESEL", "NONE")
    COALESCE(
        string_to_array(NULLIF(d.fuel_types_raw, ''), ','),
        ARRAY[]::text[]
    ) AS fuel_types,

    d.placement,
    d.type_val,
    d.year_start,
    d.year_end
FROM data d
ON CONFLICT (part_no) DO NOTHING
`

type BulkCreateModelVariantsParams struct {
	PartNos         []string
	Gens            []string
	EngineCcs       []float64
	Transmissions   []string
	AdditionalInfos []string
	Image1Links     []string
	Image2Links     []string
	Image3Links     []string
	Image4Links     []string
	HsnCodes        []string
	Descriptions    []string
	OemIds          []string
	Makes           []string
	UnicodeVals     []string
	VendorIds       []string
	PlatformCodes   []string
	FuelTypes       []string
	Placements      []string
	Types           []string
	YearStarts      []int32
	YearEnds        []int32
}

func (q *Queries) BulkCreateModelVariants(ctx context.Context, arg BulkCreateModelVariantsParams) error {
	_, err := q.db.ExecContext(ctx, bulkCreateModelVariants,
		pq.Array(arg.PartNos),
		pq.Array(arg.Gens),
		pq.Array(arg.EngineCcs),
		pq.Array(arg.Transmissions),
		pq.Array(arg.AdditionalInfos),
		pq.Array(arg.Image1Links),
		pq.Array(arg.Image2Links),
		pq.Array(arg.Image3Links),
		pq.Array(arg.Image4Links),
		pq.Array(arg.HsnCodes),
		pq.Array(arg.Descriptions),
		pq.Array(arg.OemIds),
		pq.Array(arg.Makes),
		pq.Array(arg.UnicodeVals),
		pq.Array(arg.VendorIds),
		pq.Array(arg.PlatformCodes),
		pq.Array(arg.FuelTypes),
		pq.Array(arg.Placements),
		pq.Array(arg.Types),
		pq.Array(arg.YearStarts),
		pq.Array(arg.YearEnds),
	)
	return err
}

const bulkUpdateModelVariantsSelective = `-- name: BulkUpdateModelVariantsSelective :exec
WITH data AS (
    SELECT
        unnest($1::text[])          AS part_no,
        unnest($2::text[])              AS gen,
        unnest($3::float8[])      AS engine_cc,
        unnest($4::text[])     AS transmission_type_raw,
        unnest($5::text[])  AS additional_info,
        unnest($6::text[])         AS hsn_code,
        unnest($7::text[])      AS description,
        unnest($8::text[])           AS oem_ids_raw,
        unnest($9::text[])             AS make,
        unnest($10::text[])      AS unicode_raw,
        unnest($11::text[])        AS vendor_id_raw,
        unnest($12::text[])    AS platform_codes_raw,
        unnest($13::text[])        AS fuel_types_raw,
        unnest($14::text[])        AS placement,
        unnest($15::text[])             AS type_val,
        unnest($16::int[])        AS year_start,
        unnest($17::int[])          AS year_end
)
UPDATE model_variants mv
SET
    gen = COALESCE(NULLIF(d.gen, ''), mv.gen),
    engine_cc = COALESCE(d.engine_cc, mv.engine_cc),

    transmission_type = COALESCE(
        string_to_array(NULLIF(d.transmission_type_raw, ''), ','),
        mv.transmission_type
    ),

    additional_info = COALESCE(NULLIF(d.additional_info, ''), mv.additional_info),

    hsn_code = COALESCE(NULLIF(d.hsn_code, ''), mv.hsn_code),
    description = COALESCE(NULLIF(d.description, ''), mv.description),

    oem_ids = COALESCE(
        string_to_array(NULLIF(d.oem_ids_raw, ''), ','),
        mv.oem_ids
    ),

    make = COALESCE(NULLIF(d.make, ''), mv.make),

    unicode = COALESCE(
        string_to_array(NULLIF(d.unicode_raw, ''), ','),
        mv.unicode
    ),

    vendor_id = COALESCE(
        string_to_array(NULLIF(d.vendor_id_raw, ''), ','),
        mv.vendor_id
    ),

    platform_codes = COALESCE(
        string_to_array(NULLIF(d.platform_codes_raw, ''), ','),
        mv.platform_codes
    ),

    fuel_types = COALESCE(
        string_to_array(NULLIF(d.fuel_types_raw, ''), ','),
        mv.fuel_types
    ),

    placement = COALESCE(NULLIF(d.placement, ''), mv.placement),
    type = COALESCE(NULLIF(d.type_val, ''), mv.type),
    year_start = COALESCE(d.year_start, mv.year_start),
    year_end = COALESCE(d.year_end, mv.year_end)

FROM data d
WHERE mv.part_no = d.part_no
`

type BulkUpdateModelVariantsSelectiveParams struct {
	PartNos         []string
	Gens            []string
	EngineCcs       []float64
	Transmissions   []string
	AdditionalInfos []string
	HsnCodes        []string
	Descriptions    []string
	OemIds          []string
	Makes           []string
	UnicodeVals     []string
	VendorIds       []string
	PlatformCodes   []string
	FuelTypes       []string
	Placements      []string
	Types           []string
	YearStarts      []int32
	YearEnds        []int32
}

func (q *Queries) BulkUpdateModelVariantsSelective(ctx context.Context, arg BulkUpdateModelVariantsSelectiveParams) error {
	_, err := q.db.ExecContext(ctx, bulkUpdateModelVariantsSelective,
		pq.Array(arg.PartNos),
		pq.Array(arg.Gens),
		pq.Array(arg.EngineCcs),
		pq.Array(arg.Transmissions),
		pq.Array(arg.AdditionalInfos),
		pq.Array(arg.HsnCodes),
		pq.Array(arg.Descriptions),
		pq.Array(arg.OemIds),
		pq.Array(arg.Makes),
		pq.Array(arg.UnicodeVals),
		pq.Array(arg.VendorIds),
		pq.Array(arg.PlatformCodes),
		pq.Array(arg.FuelTypes),
		pq.Array(arg.Placements),
		pq.Array(arg.Types),
		pq.Array(arg.YearStarts),
		pq.Array(arg.YearEnds),
	)
	return err
}

const createModelVariant = `-- name: CreateModelVariant :one
INSERT INTO model_variants (
    id,
    part_no,
    type,
    fuel_types,            -- Array of fuel types
    gen,
    engine_cc,
    transmission_type,
    platform_codes,        -- Array of platform codes
    additional_info,
    image_1_link,
    image_2_link,
    image_3_link,
    image_4_link,
    oem_ids,
    make,
    vendor_id,
    hsn_code,
    unicode,
    description,
    placement,             -- Default placement value
    year_start,            -- Newly added column
    year_end               -- Newly added column
)
VALUES (
    $1,  -- id
    $2,  -- part_no
    $3,  -- type
    $4,  -- fuel_types (array of fuel types)
    $5,  -- gen
    $6,  -- engine_cc
    $7,  -- transmission_type
    $8,  -- platform_codes (array of platform codes)
    $9,  -- additional_info
    $10, -- image_1_link
    $11, -- image_2_link
    $12, -- image_3_link
    $13, -- image_4_link
    $14, -- oem_ids
    $15, -- make
    $16, -- vendor_id
    $17, -- hsn_code
    $18, -- unicode
    $19, -- description
    $20, -- placement
    $21, -- year_start
    $22  -- year_end
)
RETURNING id, part_no, type, gen, fuel_types, hsn_code, engine_cc, transmission_type, platform_codes, placement, image_1_link, image_2_link, image_3_link, image_4_link, make, oem_ids, vendor_id, unicode, description, additional_info, year_start, year_end
`

type CreateModelVariantParams struct {
	ID               uuid.UUID
	PartNo           string
	Type             string
	FuelTypes        []string
	Gen              sql.NullString
	EngineCc         sql.NullFloat64
	TransmissionType []string
	PlatformCodes    []string
	AdditionalInfo   sql.NullString
	Image1Link       sql.NullString
	Image2Link       sql.NullString
	Image3Link       sql.NullString
	Image4Link       sql.NullString
	OemIds           []string
	Make             string
	VendorID         []string
	HsnCode          sql.NullString
	Unicode          []string
	Description      sql.NullString
	Placement        string
	YearStart        sql.NullInt32
	YearEnd          sql.NullInt32
}

// ----------------------------------------------------------------------------------------------------------------------------
// Mutation
// -----------------------------------------------------------------------------------------------------------------------------
func (q *Queries) CreateModelVariant(ctx context.Context, arg CreateModelVariantParams) (ModelVariant, error) {
	row := q.db.QueryRowContext(ctx, createModelVariant,
		arg.ID,
		arg.PartNo,
		arg.Type,
		pq.Array(arg.FuelTypes),
		arg.Gen,
		arg.EngineCc,
		pq.Array(arg.TransmissionType),
		pq.Array(arg.PlatformCodes),
		arg.AdditionalInfo,
		arg.Image1Link,
		arg.Image2Link,
		arg.Image3Link,
		arg.Image4Link,
		pq.Array(arg.OemIds),
		arg.Make,
		pq.Array(arg.VendorID),
		arg.HsnCode,
		pq.Array(arg.Unicode),
		arg.Description,
		arg.Placement,
		arg.YearStart,
		arg.YearEnd,
	)
	var i ModelVariant
	err := row.Scan(
		&i.ID,
		&i.PartNo,
		&i.Type,
		&i.Gen,
		pq.Array(&i.FuelTypes),
		&i.HsnCode,
		&i.EngineCc,
		pq.Array(&i.TransmissionType),
		pq.Array(&i.PlatformCodes),
		&i.Placement,
		&i.Image1Link,
		&i.Image2Link,
		&i.Image3Link,
		&i.Image4Link,
		&i.Make,
		pq.Array(&i.OemIds),
		pq.Array(&i.VendorID),
		pq.Array(&i.Unicode),
		&i.Description,
		&i.AdditionalInfo,
		&i.YearStart,
		&i.YearEnd,
	)
	return i, err
}

const deleteModelVariantByPartNo = `-- name: DeleteModelVariantByPartNo :execresult


DELETE FROM model_variants
WHERE part_no = $1
`

// Return the updated record
func (q *Queries) DeleteModelVariantByPartNo(ctx context.Context, partNo string) (sql.Result, error) {
	return q.db.ExecContext(ctx, deleteModelVariantByPartNo, partNo)
}

const getModelVariantByPartNo = `-- name: GetModelVariantByPartNo :one

SELECT id, part_no, type, gen, fuel_types, hsn_code, engine_cc, transmission_type, platform_codes, placement, image_1_link, image_2_link, image_3_link, image_4_link, make, oem_ids, vendor_id, unicode, description, additional_info, year_start, year_end FROM model_variants WHERE part_no=$1
`

// ----------------------------------------------------------------------------------------------------------------------------
// Query
// ----------------------------------------------------------------------------------------------------------------------------
func (q *Queries) GetModelVariantByPartNo(ctx context.Context, partNo string) (ModelVariant, error) {
	row := q.db.QueryRowContext(ctx, getModelVariantByPartNo, partNo)
	var i ModelVariant
	err := row.Scan(
		&i.ID,
		&i.PartNo,
		&i.Type,
		&i.Gen,
		pq.Array(&i.FuelTypes),
		&i.HsnCode,
		&i.EngineCc,
		pq.Array(&i.TransmissionType),
		pq.Array(&i.PlatformCodes),
		&i.Placement,
		&i.Image1Link,
		&i.Image2Link,
		&i.Image3Link,
		&i.Image4Link,
		&i.Make,
		pq.Array(&i.OemIds),
		pq.Array(&i.VendorID),
		pq.Array(&i.Unicode),
		&i.Description,
		&i.AdditionalInfo,
		&i.YearStart,
		&i.YearEnd,
	)
	return i, err
}

const getModelVariantDownloadDetails = `-- name: GetModelVariantDownloadDetails :many
SELECT
    pp.part_no                       AS "Part No",
    c.name                           AS "Company",
    mdl.name                         AS "Model",
    b.name                           AS "Brand",
    cat.name                         AS "Category",

    m.type                           AS "Type",
    m.make                           AS "Make",
    m.gen                            AS "Generation",
    m.year_start                     AS "Year Start",
    m.year_end                       AS "Year End",
    m.engine_cc                      AS "Engine CC",
    m.transmission_type              AS "Transmission",
    m.placement                      AS "Placement",
    m.hsn_code                       AS "HSN Code",
    m.unicode                        AS "Unicode",
    m.description                    AS "Description",
    m.additional_info                AS "Additional Info",
    m.fuel_types                     AS "Fuel Types",
    m.platform_codes                 AS "Platform Codes",
    m.oem_ids                        AS "OEM IDs",
    m.vendor_id                      AS "Vendor IDs"

FROM model_variants m
JOIN product_parts pp ON pp.part_no = m.part_no
JOIN companies     c  ON c.id       = pp.company_id
JOIN models        mdl ON mdl.id    = pp.model_id
JOIN brands        b   ON b.id      = pp.brand_id
JOIN categories    cat ON cat.id    = pp.category_id
`

type GetModelVariantDownloadDetailsRow struct {
	PartNo         string
	Company        string
	Model          string
	Brand          string
	Category       string
	Type           string
	Make           string
	Generation     sql.NullString
	YearStart      sql.NullInt32
	YearEnd        sql.NullInt32
	EngineCC       sql.NullFloat64
	Transmission   []string
	Placement      string
	HSNCode        sql.NullString
	Unicode        []string
	Description    sql.NullString
	AdditionalInfo sql.NullString
	FuelTypes      []string
	PlatformCodes  []string
	OEMIDs         []string
	VendorIDs      []string
}

func (q *Queries) GetModelVariantDownloadDetails(ctx context.Context) ([]GetModelVariantDownloadDetailsRow, error) {
	rows, err := q.db.QueryContext(ctx, getModelVariantDownloadDetails)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetModelVariantDownloadDetailsRow
	for rows.Next() {
		var i GetModelVariantDownloadDetailsRow
		if err := rows.Scan(
			&i.PartNo,
			&i.Company,
			&i.Model,
			&i.Brand,
			&i.Category,
			&i.Type,
			&i.Make,
			&i.Generation,
			&i.YearStart,
			&i.YearEnd,
			&i.EngineCC,
			pq.Array(&i.Transmission),
			&i.Placement,
			&i.HSNCode,
			pq.Array(&i.Unicode),
			&i.Description,
			&i.AdditionalInfo,
			pq.Array(&i.FuelTypes),
			pq.Array(&i.PlatformCodes),
			pq.Array(&i.OEMIDs),
			pq.Array(&i.VendorIDs),
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateModelVariant = `-- name: UpdateModelVariant :one
UPDATE model_variants AS mv SET
    type = COALESCE($2, mv.type),                  -- Update type if provided
    fuel_types = COALESCE($3, mv.fuel_types),      -- Update fuel_types array if provided
    gen = COALESCE($4, mv.gen),                    -- Update gen if provided
    engine_cc = COALESCE($5, mv.engine_cc),        -- Update engine_cc if provided
    transmission_type = COALESCE($6, mv.transmission_type), -- Update transmission_type if provided
    platform_codes = COALESCE($7, mv.platform_codes), -- Update platform_codes array if provided
    additional_info = COALESCE($8, mv.additional_info), -- Update additional_info if provided
    image_1_link = COALESCE($9, mv.image_1_link),  -- Update image_1_link if provided
    image_2_link = COALESCE($10, mv.image_2_link), -- Update image_2_link if provided
    image_3_link = COALESCE($11, mv.image_3_link), -- Update image_3_link if provided
    image_4_link = COALESCE($12, mv.image_4_link), -- Update image_4_link if provided
    oem_ids = COALESCE($13, mv.oem_ids),           -- Update oem_ids array if provided
    make = COALESCE($14, mv.make),                 -- Update make if provided
    vendor_id = COALESCE($15, mv.vendor_id),       -- Update vendor_id array if provided
    hsn_code = COALESCE($16, mv.hsn_code),         -- Update hsn_code if provided
    unicode = COALESCE($17, mv.unicode),           -- Update unicode array if provided
    description = COALESCE($18, mv.description),   -- Update description if provided
    placement = COALESCE($19, mv.placement),       -- Update placement if provided
    year_start = COALESCE($20, mv.year_start),     -- Update year_start if provided
    year_end = COALESCE($21, mv.year_end)          -- Update year_end if provided
WHERE mv.part_no = $1                              -- Ensure update is done for the correct part_no
RETURNING id, part_no, type, gen, fuel_types, hsn_code, engine_cc, transmission_type, platform_codes, placement, image_1_link, image_2_link, image_3_link, image_4_link, make, oem_ids, vendor_id, unicode, description, additional_info, year_start, year_end
`

type UpdateModelVariantParams struct {
	PartNo           string
	Type             string
	FuelTypes        []string
	Gen              sql.NullString
	EngineCc         sql.NullFloat64
	TransmissionType []string
	PlatformCodes    []string
	AdditionalInfo   sql.NullString
	Image1Link       sql.NullString
	Image2Link       sql.NullString
	Image3Link       sql.NullString
	Image4Link       sql.NullString
	OemIds           []string
	Make             string
	VendorID         []string
	HsnCode          sql.NullString
	Unicode          []string
	Description      sql.NullString
	Placement        string
	YearStart        sql.NullInt32
	YearEnd          sql.NullInt32
}

func (q *Queries) UpdateModelVariant(ctx context.Context, arg UpdateModelVariantParams) (ModelVariant, error) {
	row := q.db.QueryRowContext(ctx, updateModelVariant,
		arg.PartNo,
		arg.Type,
		pq.Array(arg.FuelTypes),
		arg.Gen,
		arg.EngineCc,
		pq.Array(arg.TransmissionType),
		pq.Array(arg.PlatformCodes),
		arg.AdditionalInfo,
		arg.Image1Link,
		arg.Image2Link,
		arg.Image3Link,
		arg.Image4Link,
		pq.Array(arg.OemIds),
		arg.Make,
		pq.Array(arg.VendorID),
		arg.HsnCode,
		pq.Array(arg.Unicode),
		arg.Description,
		arg.Placement,
		arg.YearStart,
		arg.YearEnd,
	)
	var i ModelVariant
	err := row.Scan(
		&i.ID,
		&i.PartNo,
		&i.Type,
		&i.Gen,
		pq.Array(&i.FuelTypes),
		&i.HsnCode,
		&i.EngineCc,
		pq.Array(&i.TransmissionType),
		pq.Array(&i.PlatformCodes),
		&i.Placement,
		&i.Image1Link,
		&i.Image2Link,
		&i.Image3Link,
		&i.Image4Link,
		&i.Make,
		pq.Array(&i.OemIds),
		pq.Array(&i.VendorID),
		pq.Array(&i.Unicode),
		&i.Description,
		&i.AdditionalInfo,
		&i.YearStart,
		&i.YearEnd,
	)
	return i, err
}
