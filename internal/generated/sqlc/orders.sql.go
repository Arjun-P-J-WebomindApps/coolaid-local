// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: orders.sql

package sqlc

import (
	"context"
	"database/sql"

	"github.com/google/uuid"
	"github.com/lib/pq"
)

const createOrder = `-- name: CreateOrder :one

INSERT INTO orders (
    id,
    order_listing_ids,
    vendor_id,
    user_id,
    is_requested_via_email,
    is_requested_via_whatsapp
)
VALUES (
    $1,  -- id
    $2,  -- order_listing_ids (ARRAY)
    $3,  -- vendor_id
    $4,  -- user_id
    $5,  -- is_requested_via_email
    $6   -- is_requested_via_whatsapp
)
RETURNING id, order_listing_ids, vendor_id, user_id, is_requested_via_email, is_requested_via_whatsapp, created_at, updated_at
`

type CreateOrderParams struct {
	ID                     uuid.UUID
	OrderListingIds        []string
	VendorID               uuid.NullUUID
	UserID                 uuid.NullUUID
	IsRequestedViaEmail    sql.NullBool
	IsRequestedViaWhatsapp sql.NullBool
}

// -------------------------------------------------------------------
// ‚öôÔ∏è MUTATIONS (Write Operations)
// These statements CREATE, UPDATE, or DELETE data in the database.
// -------------------------------------------------------------------
func (q *Queries) CreateOrder(ctx context.Context, arg CreateOrderParams) (Order, error) {
	row := q.db.QueryRowContext(ctx, createOrder,
		arg.ID,
		pq.Array(arg.OrderListingIds),
		arg.VendorID,
		arg.UserID,
		arg.IsRequestedViaEmail,
		arg.IsRequestedViaWhatsapp,
	)
	var i Order
	err := row.Scan(
		&i.ID,
		pq.Array(&i.OrderListingIds),
		&i.VendorID,
		&i.UserID,
		&i.IsRequestedViaEmail,
		&i.IsRequestedViaWhatsapp,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deleteOrderById = `-- name: DeleteOrderById :exec
DELETE FROM orders
WHERE id = $1
`

func (q *Queries) DeleteOrderById(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.ExecContext(ctx, deleteOrderById, id)
	return err
}

const getAllRestockOrders = `-- name: GetAllRestockOrders :many
SELECT
    o.id,
    o.created_at AS order_date,
    v.company_name AS vendor_name,
    o.is_requested_via_email AS is_requested_by_email,
    o.is_requested_via_whatsapp AS is_requested_by_whatsapp,
    o2.part_no AS part_number,
    o2.quantity AS quantity_ordered
FROM
    orders AS o
LEFT JOIN
    orders_listing AS o2
    ON o2.id = ANY(o.order_listing_ids::uuid[])
LEFT JOIN
    vendors AS v
    ON v.id = o.vendor_id
ORDER BY
    o.created_at DESC
`

type GetAllRestockOrdersRow struct {
	ID                    uuid.UUID
	OrderDate             sql.NullTime
	VendorName            sql.NullString
	IsRequestedByEmail    sql.NullBool
	IsRequestedByWhatsapp sql.NullBool
	PartNumber            sql.NullString
	QuantityOrdered       sql.NullInt32
}

func (q *Queries) GetAllRestockOrders(ctx context.Context) ([]GetAllRestockOrdersRow, error) {
	rows, err := q.db.QueryContext(ctx, getAllRestockOrders)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetAllRestockOrdersRow
	for rows.Next() {
		var i GetAllRestockOrdersRow
		if err := rows.Scan(
			&i.ID,
			&i.OrderDate,
			&i.VendorName,
			&i.IsRequestedByEmail,
			&i.IsRequestedByWhatsapp,
			&i.PartNumber,
			&i.QuantityOrdered,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getOrdersByUserId = `-- name: GetOrdersByUserId :many

SELECT id, order_listing_ids, vendor_id, user_id, is_requested_via_email, is_requested_via_whatsapp, created_at, updated_at
FROM orders
WHERE user_id = $1
`

// -------------------------------------------------------------------
// üìò QUERIES (Read Operations)
// These statements only READ data from the database.
// -------------------------------------------------------------------
func (q *Queries) GetOrdersByUserId(ctx context.Context, userID uuid.NullUUID) ([]Order, error) {
	rows, err := q.db.QueryContext(ctx, getOrdersByUserId, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Order
	for rows.Next() {
		var i Order
		if err := rows.Scan(
			&i.ID,
			pq.Array(&i.OrderListingIds),
			&i.VendorID,
			&i.UserID,
			&i.IsRequestedViaEmail,
			&i.IsRequestedViaWhatsapp,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateOrderStatusById = `-- name: UpdateOrderStatusById :one
UPDATE orders SET
  is_requested_via_email = COALESCE($2, is_requested_via_email),
  is_requested_via_whatsapp = COALESCE($3, is_requested_via_whatsapp)
WHERE id = $1
RETURNING id, order_listing_ids, vendor_id, user_id, is_requested_via_email, is_requested_via_whatsapp, created_at, updated_at
`

type UpdateOrderStatusByIdParams struct {
	ID                     uuid.UUID
	IsRequestedViaEmail    sql.NullBool
	IsRequestedViaWhatsapp sql.NullBool
}

func (q *Queries) UpdateOrderStatusById(ctx context.Context, arg UpdateOrderStatusByIdParams) (Order, error) {
	row := q.db.QueryRowContext(ctx, updateOrderStatusById, arg.ID, arg.IsRequestedViaEmail, arg.IsRequestedViaWhatsapp)
	var i Order
	err := row.Scan(
		&i.ID,
		pq.Array(&i.OrderListingIds),
		&i.VendorID,
		&i.UserID,
		&i.IsRequestedViaEmail,
		&i.IsRequestedViaWhatsapp,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
