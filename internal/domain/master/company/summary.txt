D:\Local\coolaid-backend-model\internal\domain\master\company\create.go
package company

import (
	"context"
	"time"

	"github.com/webomindapps-dev/coolaid-backend/internal/domain/master/shared"
)

func (s *Service) Create(
	ctx context.Context,
	input CreateCompanyInput,
) (*Company, error) {

	id := shared.NewID().String()

	row, err := s.DB.Queries().CreateCompany(ctx, CreateCompanyParams{
		ID:        id,
		Name:      input.Name,
		Status:    input.Status,
		ImageURL:  input.ImageURL,
		CreatedAt: time.Now(),
		UpdatedAt: time.Now(),
	})
	if err != nil {
		return nil, ErrInternal
	}

	return mapRowToModel(row), nil
}

D:\Local\coolaid-backend-model\internal\domain\master\company\db_models.go
package company

import "time"

type CompanyRow struct {
	ID        string
	Name      string
	Status    bool
	ImageURL  string
	CreatedAt time.Time
	UpdatedAt time.Time
}

D:\Local\coolaid-backend-model\internal\domain\master\company\db_params.go
package company

import "time"

type CreateCompanyParams struct {
	ID        string
	Name      string
	Status    bool
	ImageURL  string
	CreatedAt time.Time
	UpdatedAt time.Time
}

type UpdateCompanyParams struct {
	ID        string
	Name      *string
	Status    *bool
	ImageURL  *string
	UpdatedAt time.Time
}

D:\Local\coolaid-backend-model\internal\domain\master\company\delete.go
package company

import (
	"context"

	"github.com/webomindapps-dev/coolaid-backend/internal/domain/master/shared"
)

func (s *Service) Delete(ctx context.Context, id string) error {

	if err := s.DB.Queries().DeleteCompany(ctx, shared.ID(id)); err != nil {
		return ErrCompanyNotFound
	}
	return nil
}

D:\Local\coolaid-backend-model\internal\domain\master\company\errors.go
package company

import "errors"

var (
	ErrCompanyNotFound = errors.New("company not found")
	ErrCompanyExists   = errors.New("company already exists")
	ErrInvalidInput    = errors.New("invalid input")
	ErrInternal        = errors.New("internal error")
)

D:\Local\coolaid-backend-model\internal\domain\master\company\inputs.go
package company

type CreateCompanyInput struct {
	Name     string
	Status   bool
	ImageURL string
}

type UpdateCompanyInput struct {
	ID       string
	Name     *string
	Status   *bool
	ImageURL *string
}

D:\Local\coolaid-backend-model\internal\domain\master\company\interfaces.go
package company

import (
	"context"

	"github.com/webomindapps-dev/coolaid-backend/internal/domain/master/shared"
)

// Domain-level queries (NOT sqlc)
type Queries interface {
	// Reads
	GetCompanyByID(ctx context.Context, id shared.ID) (*CompanyRow, error)
	GetCompaniesByName(ctx context.Context, name string) ([]CompanyRow, error)

	// Writes
	CreateCompany(ctx context.Context, p CreateCompanyParams) (*CompanyRow, error)
	UpdateCompany(ctx context.Context, p UpdateCompanyParams) (*CompanyRow, error)
	DeleteCompany(ctx context.Context, id shared.ID) error
}

// Same semantics as auth:
// - Queries(): domain queries
// - BeginTx(): sqlc escape hatch
type DB = shared.DB[Queries]

D:\Local\coolaid-backend-model\internal\domain\master\company\mapper.go
package company

func mapRowToModel(r *CompanyRow) *Company {
	return &Company{
		ID:       r.ID,
		Name:     r.Name,
		Status:   r.Status,
		ImageURL: r.ImageURL,
	}
}

D:\Local\coolaid-backend-model\internal\domain\master\company\models.go
package company

type Company struct {
	ID       string
	Name     string
	Status   bool
	ImageURL string
}

D:\Local\coolaid-backend-model\internal\domain\master\company\queries.go
package company

import (
	"context"

	"github.com/webomindapps-dev/coolaid-backend/internal/domain/master/shared"
)

func (s *Service) GetByID(ctx context.Context, id string) (*Company, error) {
	row, err := s.DB.Queries().GetCompanyByID(ctx, shared.ID(id))
	if err != nil {
		return nil, ErrCompanyNotFound
	}
	return mapRowToModel(row), nil
}

func (s *Service) ListByName(ctx context.Context, name *string) ([]Company, error) {
	rows, err := s.DB.Queries().GetCompaniesByName(
		ctx,
		shared.ValueOrEmpty(name),
	)
	if err != nil {
		return nil, ErrInternal
	}

	out := make([]Company, 0, len(rows))
	for _, r := range rows {
		out = append(out, *mapRowToModel(&r))
	}

	return out, nil
}

D:\Local\coolaid-backend-model\internal\domain\master\company\service.go
package company

type Service struct {
	DB DB
}

func NewService(db DB) *Service {
	return &Service{DB: db}
}

D:\Local\coolaid-backend-model\internal\domain\master\company\update.go
package company

import (
	"context"
	"time"
)

func (s *Service) Update(
	ctx context.Context,
	input UpdateCompanyInput,
) (*Company, error) {

	row, err := s.DB.Queries().UpdateCompany(ctx, UpdateCompanyParams{
		ID:        input.ID,
		Name:      input.Name,
		Status:    input.Status,
		ImageURL:  input.ImageURL,
		UpdatedAt: time.Now(),
	})
	if err != nil {
		return nil, ErrCompanyNotFound
	}

	return mapRowToModel(row), nil
}

