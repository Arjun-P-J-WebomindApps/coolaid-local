D:\Local\coolaid-backend-model\internal\domain\master\customer\create.go
package customer

import (
	"context"

	"github.com/webomindapps-dev/coolaid-backend/internal/domain/master/shared"
)

func (s *Service) Create(
	ctx context.Context,
	input CreateCustomerInput,
) (*Customer, error) {

	_, err := s.DB.Queries().GetCustomerByUniqueKey(
		ctx,
		input.CustomerCompanyName,
		input.ContactPerson,
		input.Mobile,
		input.Type,
	)
	if err == nil {
		return nil, ErrCustomerExists
	}

	row, err := s.DB.Queries().CreateCustomer(ctx, CreateCustomerParams{
		ID:                  shared.NewID().String(),
		CustomerCompanyName: input.CustomerCompanyName,
		ContactPerson:       input.ContactPerson,
		Mobile:              input.Mobile,
		Type:                input.Type,
		CustomerDesignation: input.CustomerDesignation,
		Address:             input.Address,
		Flat:                input.Flat,
		Street:              input.Street,
		City:                input.City,
		State:               input.State,
		Pincode:             input.Pincode,
		PaymentMode:         input.PaymentMode,
	})
	if err != nil {
		return nil, ErrInternal
	}

	return mapRowToModel(row), nil
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\db_models.go
package customer

type CustomerRow struct {
	ID                  string
	CustomerCompanyName string
	ContactPerson       string
	Mobile              string
	Type                string
	CustomerDesignation *string
	Address             *string
	Flat                *string
	Street              *string
	City                *string
	State               *string
	Pincode             *string
	PaymentMode         *string
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\db_params.go
package customer

type CreateCustomerParams struct {
	ID                  string
	CustomerCompanyName string
	ContactPerson       string
	Mobile              string
	Type                string
	CustomerDesignation *string
	Address             *string
	Flat                *string
	Street              *string
	City                *string
	State               *string
	Pincode             *string
	PaymentMode         *string
}

type UpdateCustomerParams struct {
	ID                  string
	CustomerCompanyName *string
	ContactPerson       *string
	Mobile              *string
	Type                *string
	CustomerDesignation *string
	Address             *string
	Flat                *string
	Street              *string
	City                *string
	State               *string
	Pincode             *string
	PaymentMode         *string
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\delete.go
package customer

import (
	"context"

	"github.com/webomindapps-dev/coolaid-backend/internal/domain/master/shared"
)

func (s *Service) Delete(ctx context.Context, id string) error {
	if err := s.DB.Queries().DeleteCustomer(ctx, shared.ID(id)); err != nil {
		return ErrCustomerNotFound
	}
	return nil
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\errors.go
package customer

import "errors"

var (
	ErrCustomerNotFound = errors.New("customer not found")
	ErrCustomerExists   = errors.New("customer already exists")
	ErrInvalidInput     = errors.New("invalid input")
	ErrInternal         = errors.New("internal error")
)

D:\Local\coolaid-backend-model\internal\domain\master\customer\inputs.go
package customer

type CreateCustomerInput struct {
	CustomerCompanyName string
	ContactPerson       string
	Mobile              string
	Type                string
	CustomerDesignation *string
	Address             *string
	Flat                *string
	Street              *string
	City                *string
	State               *string
	Pincode             *string
	PaymentMode         *string
}

type UpdateCustomerInput struct {
	ID                  string
	CustomerCompanyName *string
	ContactPerson       *string
	Mobile              *string
	Type                *string
	CustomerDesignation *string
	Address             *string
	Flat                *string
	Street              *string
	City                *string
	State               *string
	Pincode             *string
	PaymentMode         *string
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\interfaces.go
package customer

import (
	"context"

	"github.com/webomindapps-dev/coolaid-backend/internal/domain/master/shared"
)

type Queries interface {
	// Reads
	GetCustomerByID(ctx context.Context, id shared.ID) (*CustomerRow, error)
	GetCustomerByUniqueKey(
		ctx context.Context,
		company string,
		contactPerson string,
		mobile string,
		customerType string,
	) (*CustomerRow, error)

	SearchCustomers(
		ctx context.Context,
		company string,
		contactPerson string,
		mobile string,
	) ([]CustomerRow, error)

	// Writes
	CreateCustomer(ctx context.Context, p CreateCustomerParams) (*CustomerRow, error)
	UpdateCustomer(ctx context.Context, p UpdateCustomerParams) (*CustomerRow, error)
	DeleteCustomer(ctx context.Context, id shared.ID) error
}

type DB = shared.DB[Queries]

D:\Local\coolaid-backend-model\internal\domain\master\customer\mapper.go
package customer

func mapRowToModel(r *CustomerRow) *Customer {
	return &Customer{
		ID:                  r.ID,
		CustomerCompanyName: r.CustomerCompanyName,
		ContactPerson:       r.ContactPerson,
		Mobile:              r.Mobile,
		Type:                r.Type,
		CustomerDesignation: r.CustomerDesignation,
		Address:             r.Address,
		Flat:                r.Flat,
		Street:              r.Street,
		City:                r.City,
		State:               r.State,
		Pincode:             r.Pincode,
		PaymentMode:         r.PaymentMode,
	}
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\models.go
package customer

type Customer struct {
	ID                  string
	CustomerCompanyName string
	ContactPerson       string
	Mobile              string
	Type                string
	CustomerDesignation *string
	Address             *string
	Flat                *string
	Street              *string
	City                *string
	State               *string
	Pincode             *string
	PaymentMode         *string
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\queries.go
package customer

import (
	"context"

	"github.com/webomindapps-dev/coolaid-backend/internal/domain/master/shared"
)

func (s *Service) GetByID(ctx context.Context, id string) (*Customer, error) {
	row, err := s.DB.Queries().GetCustomerByID(ctx, shared.ID(id))
	if err != nil {
		return nil, ErrCustomerNotFound
	}
	return mapRowToModel(row), nil
}

func (s *Service) Search(
	ctx context.Context,
	company *string,
	contactPerson *string,
	mobile *string,
) ([]Customer, error) {

	rows, err := s.DB.Queries().SearchCustomers(
		ctx,
		shared.ValueOrEmpty(company),
		shared.ValueOrEmpty(contactPerson),
		shared.ValueOrEmpty(mobile),
	)
	if err != nil {
		return nil, ErrInternal
	}

	out := make([]Customer, 0, len(rows))
	for _, r := range rows {
		out = append(out, *mapRowToModel(&r))
	}

	return out, nil
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\service.go
package customer

type Service struct {
	DB DB
}

func NewService(db DB) *Service {
	return &Service{DB: db}
}

D:\Local\coolaid-backend-model\internal\domain\master\customer\update.go
package customer

import "context"

func (s *Service) Update(
	ctx context.Context,
	input UpdateCustomerInput,
) (*Customer, error) {

	row, err := s.DB.Queries().UpdateCustomer(ctx, UpdateCustomerParams{
		ID:                  input.ID,
		CustomerCompanyName: input.CustomerCompanyName,
		ContactPerson:       input.ContactPerson,
		Mobile:              input.Mobile,
		Type:                input.Type,
		CustomerDesignation: input.CustomerDesignation,
		Address:             input.Address,
		Flat:                input.Flat,
		Street:              input.Street,
		City:                input.City,
		State:               input.State,
		Pincode:             input.Pincode,
		PaymentMode:         input.PaymentMode,
	})
	if err != nil {
		return nil, ErrCustomerNotFound
	}

	return mapRowToModel(row), nil
}

